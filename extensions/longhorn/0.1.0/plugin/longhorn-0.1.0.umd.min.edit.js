(("undefined"!==typeof self?self:this)["webpackChunklonghorn_0_1_0"]=("undefined"!==typeof self?self:this)["webpackChunklonghorn_0_1_0"]||[]).push([[739],{28173:function(e,a,o){"use strict";o.r(a);var t=o(36758),r=o.n(t),s=o(40935),n=o.n(s),l=n()(r());l.push([e.id,".force-create[data-v-11b5f0be]{align-self:center}.cron-row[data-v-11b5f0be]{display:flex;align-items:center}[data-v-11b5f0be] .kv-item.remove{align-self:center}[data-v-11b5f0be] .kv-container .key-value-label{display:none}",""]),a["default"]=l},42100:function(e,a,o){"use strict";o.r(a),o.d(a,{default:function(){return Q}});var t=o(9274);const r={key:1};function s(e,a,o,s,n,l){const i=(0,t.resolveComponent)("Loading"),d=(0,t.resolveComponent)("NameNsDescription"),c=(0,t.resolveComponent)("Basics"),u=(0,t.resolveComponent)("Tab"),p=(0,t.resolveComponent)("Disks"),v=(0,t.resolveComponent)("Tabbed"),m=(0,t.resolveComponent)("CruResource");return e.$fetchState.pending?((0,t.openBlock)(),(0,t.createBlock)(i,{key:0})):((0,t.openBlock)(),(0,t.createElementBlock)("div",r,[(0,t.createVNode)(m,{"done-route":e.doneRoute,mode:o.mode,resource:o.value,"validation-passed":l.isFormValid,errors:e.fvUnreportedValidationErrors,onFinish:l.save,onCancel:e.done},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(d,{value:o.value,mode:o.mode,namespaced:!1},null,8,["value","mode"]),(0,t.createVNode)(v,{"side-tabs":"",resource:o.value},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(u,{name:"basics","label-key":"longhorn.node.tab.basics",error:l.tabErrors.basics},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(c,{mode:o.mode,value:o.value,conditions:l.nodeConditions,rules:l.basicValidationRules},null,8,["mode","value","conditions","rules"])]),_:1},8,["error"]),(0,t.createVNode)(u,{name:"disk","label-key":"longhorn.node.tab.disks",error:l.tabErrors.disks},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(p,{mode:o.mode,value:o.value,conditions:l.diskConditions,rules:l.diskValidationRules,onAdd:l.addDisk,onRemove:l.removeDisk},null,8,["mode","value","conditions","rules","onAdd","onRemove"])]),_:1},8,["error"])]),_:1},8,["resource"])]),_:1},8,["done-route","mode","resource","validation-passed","errors","onFinish","onCancel"])]))}var n=o(87619),l=o(81984),i=o(79287),d=o(52879),c=o(38891),u=o(91825),p=o(77651),v=o(14220),m=o(99726),h=o(76978),b=o(92043);const k={class:"row mb-10 conditions"},g={class:"row mb-20"},f={class:"col span-6"};function y(e,a,o,r,s,n){const l=(0,t.resolveComponent)("BadgeState"),i=(0,t.resolveComponent)("LabeledInput"),d=(0,t.resolveComponent)("UnitInput"),c=(0,t.resolveComponent)("RadioGroup"),u=(0,t.resolveComponent)("ArrayList"),p=(0,t.resolveDirective)("clean-tooltip");return(0,t.openBlock)(),(0,t.createElementBlock)("div",null,[(0,t.createElementVNode)("div",k,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(o.conditions,e=>(0,t.withDirectives)(((0,t.openBlock)(),(0,t.createBlock)(l,{key:e.key,class:"mr-10 mb-10",value:e.value,icon:e.icon},null,8,["value","icon"])),[[p,e.tooltip]])),128))]),(0,t.createElementVNode)("div",g,[(0,t.createElementVNode)("div",f,[(0,t.createVNode)(i,{value:o.value.status.region,"onUpdate:value":a[0]||(a[0]=e=>o.value.status.region=e),class:"mb-10",label:e.t("longhorn.node.form.region"),mode:o.mode,disabled:""},null,8,["value","label","mode"]),(0,t.createVNode)(i,{value:o.value.status.zone,"onUpdate:value":a[1]||(a[1]=e=>o.value.status.zone=e),class:"mb-10",label:e.t("longhorn.node.form.zone"),mode:o.mode,disabled:""},null,8,["value","label","mode"]),(0,t.createVNode)(d,{value:o.value.spec.instanceManagerCPURequest,"onUpdate:value":a[2]||(a[2]=e=>o.value.spec.instanceManagerCPURequest=e),class:"mb-20",label:e.t("longhorn.node.form.instanceManagerCPURequest"),mode:o.mode,suffix:"m",min:0,required:!0,rules:o.rules?.instanceManagerCPURequest},null,8,["value","label","mode","rules"]),(0,t.createVNode)(c,{value:o.value.spec.allowScheduling,"onUpdate:value":a[3]||(a[3]=e=>o.value.spec.allowScheduling=e),name:"nodeScheduling",class:"mb-20",label:e.t("longhorn.node.form.scheduling"),mode:o.mode,options:n.nodeSchedulingOptions,row:!0},null,8,["value","label","mode","options"]),(0,t.createVNode)(c,{value:o.value.spec.evictionRequested,"onUpdate:value":a[4]||(a[4]=e=>o.value.spec.evictionRequested=e),name:"nodeEvictionRequested",class:"mb-20",label:e.t("longhorn.node.form.evictionRequested"),mode:o.mode,options:n.evictionRequestedOptions,row:!0},null,8,["value","label","mode","options"]),(0,t.createVNode)(u,{value:o.value.spec.tags,"onUpdate:value":a[5]||(a[5]=e=>o.value.spec.tags=e),mode:o.mode,title:e.t("longhorn.node.form.tags"),"add-label":e.t("longhorn.node.form.addTags")},{title:(0,t.withCtx)(()=>[(0,t.createElementVNode)("h4",null,(0,t.toDisplayString)(e.t("longhorn.node.form.tags")),1)]),_:1},8,["value","mode","title","add-label"])])])])}var C=o(88268),N=o(74020),E=o(79380),A=o(64676),R=o(41418),S={components:{BadgeState:R.j,LabeledInput:E.o,UnitInput:N.A,RadioGroup:C.z,ArrayList:A.A},props:{mode:{type:String,required:!0},value:{type:Object,required:!0},conditions:{type:Array,default:()=>[]},rules:{type:Object,default:()=>({})}},computed:{nodeSchedulingOptions(){return[{label:this.t("generic.enabled"),value:!0},{label:this.t("generic.disabled"),value:!1}]},evictionRequestedOptions(){return[{label:this.t("generic.trueOption"),value:!0},{label:this.t("generic.falseOption"),value:!1}]}}},V=(o(66960),o(47433));const _=(0,V.A)(S,[["render",y],["__scopeId","data-v-b0addee8"]]);var T=_;const U={key:0,class:"disk-container"},B={class:"row mb-10 conditions"},I={class:"row mb-10"},O={class:"col span-6"},P={class:"row mb-20"},w={class:"col span-4"},L={class:"col span-4"},K={class:"col span-4"},M={class:"row"},q={class:"col span-6"};function x(e,a,o,r,s,n){const l=(0,t.resolveComponent)("Banner"),i=(0,t.resolveComponent)("BadgeState"),d=(0,t.resolveComponent)("LabeledInput"),c=(0,t.resolveComponent)("LabeledSelect"),u=(0,t.resolveComponent)("UnitInput"),p=(0,t.resolveComponent)("LabelValue"),v=(0,t.resolveComponent)("RadioGroup"),m=(0,t.resolveComponent)("ArrayList"),h=(0,t.resolveComponent)("ArrayListGrouped"),b=(0,t.resolveDirective)("clean-tooltip");return(0,t.openBlock)(),(0,t.createElementBlock)("div",null,[(0,t.createVNode)(l,{color:"info","label-key":"longhorn.node.form.removeDiskMessage"}),(0,t.createVNode)(h,{value:o.value.disks,mode:o.mode,"can-remove":n.canBeRemoved,"add-label":e.t("longhorn.node.form.addDisk"),onAdd:a[0]||(a[0]=a=>e.$emit("add")),onRemove:a[1]||(a[1]=a=>e.$emit("remove",a.row.value.id))},{default:(0,t.withCtx)(({row:{value:a}})=>[a&&o.value.spec.disks[a.id]?((0,t.openBlock)(),(0,t.createElementBlock)("div",U,[(0,t.createElementVNode)("div",B,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(o.conditions[a.id],e=>(0,t.withDirectives)(((0,t.openBlock)(),(0,t.createBlock)(i,{key:e.key,class:"mr-10 mb-10",value:e.value,icon:e.icon},null,8,["value","icon"])),[[b,e.tooltip]])),128))]),(0,t.createElementVNode)("div",I,[(0,t.createElementVNode)("div",O,[(0,t.createVNode)(d,{value:o.value.spec.disks[a.id].name,"onUpdate:value":e=>o.value.spec.disks[a.id].name=e,class:"mb-10",label:e.t("longhorn.node.form.name"),mode:o.mode,disabled:o.mode===s._VIEW||!o.value.spec.disks[a.id].isNew,rules:o.rules[a.id]?.name||[]},null,8,["value","onUpdate:value","label","mode","disabled","rules"]),(0,t.createVNode)(c,{value:o.value.spec.disks[a.id].diskType,"onUpdate:value":e=>o.value.spec.disks[a.id].diskType=e,class:"mb-10",label:e.t("longhorn.node.form.diskType"),mode:o.mode,disabled:o.mode===s._VIEW||!o.value.spec.disks[a.id].isNew,options:n.diskTypeOptions},null,8,["value","onUpdate:value","label","mode","disabled","options"]),(0,t.createVNode)(d,{value:o.value.spec.disks[a.id].path,"onUpdate:value":e=>o.value.spec.disks[a.id].path=e,class:"mb-10",label:e.t("longhorn.node.form.diskPath"),mode:o.mode,disabled:o.mode===s._VIEW||!o.value.spec.disks[a.id].isNew,rules:o.rules[a.id]?.path||[]},null,8,["value","onUpdate:value","label","mode","disabled","rules"]),(0,t.createVNode)(u,{value:o.value.spec.disks[a.id].storageReserved,"onUpdate:value":e=>o.value.spec.disks[a.id].storageReserved=e,class:"mb-10","input-exponent":3,increment:1024,label:e.t("longhorn.node.form.storageReserved"),mode:o.mode,min:0,required:!0,rules:o.rules[a.id]?.storageReserved||[]},null,8,["value","onUpdate:value","label","mode","rules"])])]),(0,t.createElementVNode)("div",P,[(0,t.createElementVNode)("div",w,[(0,t.createVNode)(p,{name:e.t("longhorn.node.form.storageAvailable"),value:a.isNew?`0 ${s.GiB_UNIT}`:`${n.bytesToGi(a.storageAvailable||0)} ${s.GiB_UNIT}`},null,8,["name","value"])]),(0,t.createElementVNode)("div",L,[(0,t.createVNode)(p,{name:e.t("longhorn.node.form.storageScheduled"),value:a.isNew?`0 ${s.GiB_UNIT}`:`${n.bytesToGi(a.storageScheduled||0)} ${s.GiB_UNIT}`},null,8,["name","value"])]),(0,t.createElementVNode)("div",K,[(0,t.createVNode)(p,{name:e.t("longhorn.node.form.storageMaximum"),value:a.isNew?`0 ${s.GiB_UNIT}`:`${n.bytesToGi(a.storageMaximum||0)} ${s.GiB_UNIT}`},null,8,["name","value"])])]),(0,t.createElementVNode)("div",M,[(0,t.createElementVNode)("div",q,[(0,t.createVNode)(v,{value:o.value.spec.disks[a.id].allowScheduling,"onUpdate:value":e=>o.value.spec.disks[a.id].allowScheduling=e,name:`diskScheduling-${a.id}`,class:"mb-20",label:e.t("longhorn.node.form.scheduling"),mode:o.mode,options:n.nodeSchedulingOptions,row:!0},null,8,["value","onUpdate:value","name","label","mode","options"]),(0,t.createVNode)(v,{value:o.value.spec.disks[a.id].evictionRequested,"onUpdate:value":e=>o.value.spec.disks[a.id].evictionRequested=e,name:`diskEviction-${a.id}`,class:"mb-20",label:e.t("longhorn.node.form.evictionRequested"),mode:o.mode,options:n.evictionRequestedOptions,row:!0},null,8,["value","onUpdate:value","name","label","mode","options"]),(0,t.createVNode)(m,{value:o.value.spec.disks[a.id].tags,"onUpdate:value":e=>o.value.spec.disks[a.id].tags=e,mode:o.mode,title:e.t("longhorn.node.form.tags"),"add-label":e.t("longhorn.node.form.addTags")},{title:(0,t.withCtx)(()=>[(0,t.createElementVNode)("h4",null,(0,t.toDisplayString)(e.t("longhorn.node.form.tags")),1)]),_:2},1032,["value","onUpdate:value","mode","title","add-label"])])])])):(0,t.createCommentVNode)("",!0)]),_:1},8,["value","mode","can-remove","add-label"])])}var G=o(39412),D=o(30279),F=o(90175),J=o(68745),Y=o(35149),$=o(84918),W={components:{BadgeState:R.j,UnitInput:N.A,LabeledInput:E.o,LabeledSelect:F.A,RadioGroup:C.z,ArrayList:A.A,LabelValue:G.A,ArrayListGrouped:D.A,Banner:J.A},props:{mode:{type:String,required:!0},value:{type:Object,required:!0},conditions:{type:Object,default:()=>({})},rules:{type:Object,default:()=>({})}},data(){return{_VIEW:v.nW,GiB_UNIT:$._}},computed:{diskTypeOptions(){return[{label:this.t("longhorn.node.form.fileSystem"),value:"filesystem"},{label:this.t("longhorn.node.form.block"),value:"block"}]},nodeSchedulingOptions(){return[{label:this.t("generic.enabled"),value:!0},{label:this.t("generic.disabled"),value:!1}]},evictionRequestedOptions(){return[{label:this.t("generic.trueOption"),value:!0},{label:this.t("generic.falseOption"),value:!1}]}},methods:{bytesToGi:Y.D,canBeRemoved(e){if(this.mode===v.nW)return!1;if(e.value.isNew)return!0;const a=(e.value.storageScheduled||0)>0,o=!0===e.value.allowScheduling;return!a&&!o}}};const j=(0,V.A)(W,[["render",x]]);var Z=j,H={name:"EditNode",components:{Loading:n.A,CruResource:l.A,NameNsDescription:i.A,Tabbed:d.A,Tab:c.A,Basics:T,Disks:Z},mixins:[u.A,p.A],props:{mode:{type:String,default:v.G5},value:{type:Object,required:!0}},data(){return{_VIEW:v.nW,fvFormRuleSets:[],fvReportedValidationPaths:[]}},computed:{validationSchema(){const e=this.value.disks||[];return{basics:[{key:"instanceManagerCPURequest",path:"spec.instanceManagerCPURequest",rules:["requiredInt","isInteger","isPositive"],translationKey:"longhorn.node.form.instanceManagerCPURequest"}],disks:e.flatMap(e=>[{key:e.id,field:"name",path:`spec.disks.${e.id}.name`,rules:["required","diskNameUnique"],translationKey:"longhorn.node.form.name"},{key:e.id,field:"path",path:`spec.disks.${e.id}.path`,rules:["required"],translationKey:"longhorn.node.form.diskPath"},{key:e.id,field:"storageReserved",path:`spec.disks.${e.id}.storageReserved`,rules:["requiredInt","isInteger","isPositive"],translationKey:"longhorn.node.form.storageReserved"}])}},fvExtraRules(){return{diskNameUnique:e=>{const a=Object.values(this.value.spec?.disks||{});return a.filter(a=>a.name===e).length>1?this.t("validation.duplicate",{key:this.t("longhorn.node.form.name")}):void 0}}},tabErrors(){const e=e=>e.some(e=>{const a=(0,h.Jt)(this.value,e.path),o=this.fvGetPathRules(e.path)||[];return o.some(e=>"string"===typeof e(a))});return{basics:e(this.validationSchema.basics),disks:e(this.validationSchema.disks)}},isFormValid(){return!this.tabErrors.basics&&!this.tabErrors.disks},basicValidationRules(){return this.validationSchema.basics.reduce((e,a)=>({...e,[a.key]:this.fvGetAndReportPathRules(a.path)}),{})},diskValidationRules(){return this.validationSchema.disks.reduce((e,a)=>(e[a.key]=e[a.key]||{},e[a.key][a.field]=this.fvGetAndReportPathRules(a.path),e),{})},nodeConditions(){return this.mapConditions(this.value?.status?.conditions)},diskConditions(){return(this.value.disks||[]).reduce((e,a)=>(a.id&&a.conditions&&(e[a.id]=this.mapConditions(a.conditions)),e),{})}},methods:{mapConditions(e=[]){return(Array.isArray(e)?e:[]).map(e=>{const a=e.error||"False"===e.status,o="True"===e.status&&!a;return{key:e.type,tooltip:e.message,value:{stateBackground:a?"bg-error":e.transitioning?"bg-warning":o?"bg-success":"bg-info",stateDisplay:e.type},icon:a?"icon-error":e.transitioning?"icon-warning":o?"icon-checkmark":"icon-info"}})},addDisk(){const e=`disk-${(0,b.vx)(6)}`,a={id:e,name:e,isNew:!0,path:"",storageReserved:0,allowScheduling:!1,evictionRequested:!1,diskDriver:"",diskType:"filesystem",tags:[]};this.value.spec.disks={...this.value.spec.disks||{},[e]:a}},removeDisk(e){const a="string"===typeof e?e:e?.id,{[a]:o,...t}=this.value.spec?.disks||{};a&&(this.value.spec.disks=t)},async save(e){try{if(!this.isFormValid)return e(!1);await this.actuallySave(),e(!0),this.done()}catch(a){this.errors=(0,m.rz)(a),e(!1)}}},watch:{validationSchema:{handler(e){const a=[...e.basics,...e.disks];this.fvFormRuleSets=a.map(e=>({path:e.path,rules:e.rules,translationKey:e.translationKey})),this.fvReportedValidationPaths=a.map(e=>e.path)},immediate:!0,deep:!0},"value.spec.disks":{handler(e){if(!e)return;let a=!1;const o={...e};for(const t in o)Object.prototype.hasOwnProperty.call(o[t],"name")&&void 0!==o[t].isNew||(o[t]={...o[t],name:o[t].name||t,isNew:o[t].isNew??!1},a=!0);a&&(this.value.spec={...this.value.spec,disks:o})},immediate:!0,deep:!0}}};const z=(0,V.A)(H,[["render",s]]);var Q=z},53504:function(e,a,o){"use strict";o.r(a),o.d(a,{default:function(){return Y}});var t=o(9274);const r={key:1},s={class:"row mb-20"},n={class:"col span-6"},l={key:0,class:"col span-6 force-create"},i={class:"row mb-20"},d={class:"col span-6"},c={key:0,class:"row mb-20"},u={class:"col span-6"},p={class:"row mb-20 cron-row"},v={class:"col span-6"},m={class:"col span-6"},h={key:1,class:"row mt-40"},b={class:"col span-12"},k=["disabled","onClick"],g=["disabled","onClick"];function f(e,a,o,f,y,C){const N=(0,t.resolveComponent)("Loading"),E=(0,t.resolveComponent)("NameNsDescription"),A=(0,t.resolveComponent)("LabeledSelect"),R=(0,t.resolveComponent)("Checkbox"),S=(0,t.resolveComponent)("LabeledInput"),V=(0,t.resolveComponent)("KeyValue"),_=(0,t.resolveComponent)("Tab"),T=(0,t.resolveComponent)("ArrayList"),U=(0,t.resolveComponent)("Tabbed"),B=(0,t.resolveComponent)("CruResource"),I=(0,t.resolveComponent)("CronExpressionEditorModal"),O=(0,t.resolveDirective)("clean-tooltip");return e.$fetchState.pending?((0,t.openBlock)(),(0,t.createBlock)(N,{key:0})):((0,t.openBlock)(),(0,t.createElementBlock)("div",r,[(0,t.createVNode)(B,{"done-route":e.doneRoute,mode:o.mode,resource:o.value,"validation-passed":C.isFormValid,errors:e.fvUnreportedValidationErrors,onFinish:C.save,onCancel:e.done,onError:C.onError},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(E,{value:o.value,mode:o.mode,"force-namespace":y.LONGHORN_NAMESPACE},null,8,["value","mode","force-namespace"]),(0,t.createVNode)(U,{"side-tabs":"",resource:o.value},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(_,{name:"basics","label-key":"longhorn.recurringJob.tab.basics",error:C.tabErrors.basics},{default:(0,t.withCtx)(()=>[(0,t.createElementVNode)("div",s,[(0,t.createElementVNode)("div",n,[(0,t.createVNode)(A,{value:C.localTask,"onUpdate:value":a[0]||(a[0]=e=>C.localTask=e),mode:o.mode,label:e.t("longhorn.recurringJob.table.header.task"),options:C.taskOptions,rules:e.fvGetAndReportPathRules("spec.task"),disabled:o.mode!==y._CREATE,required:""},null,8,["value","mode","label","options","rules","disabled"])]),C.isForceCreateSupported?((0,t.openBlock)(),(0,t.createElementBlock)("div",l,[(0,t.withDirectives)((0,t.createVNode)(R,{value:y.forceCreate,"onUpdate:value":[a[1]||(a[1]=e=>y.forceCreate=e),a[2]||(a[2]=e=>C.localTask=C.localTask)],mode:o.mode,disabled:o.mode!==y._CREATE,label:e.t("longhorn.recurringJob.form.forceCreate")},null,8,["value","mode","disabled","label"]),[[O,`Create ${C.localTask===y.RECURRING_JOB_TASK.BACKUP?"backups":"snapshots"} periodically.`]])])):(0,t.createCommentVNode)("",!0)]),(0,t.createElementVNode)("div",i,[(0,t.createElementVNode)("div",d,[(0,t.createVNode)(S,{value:o.value.spec.retain,"onUpdate:value":a[3]||(a[3]=e=>o.value.spec.retain=e),valueModifiers:{number:!0},mode:o.mode,type:"number",label:e.t("longhorn.recurringJob.table.header.retain"),min:0,rules:e.fvGetAndReportPathRules("spec.retain"),disabled:C.localTask===y.RECURRING_JOB_TASK.FILESYSTEM_TRIM||o.mode===y._VIEW,required:""},null,8,["value","mode","label","rules","disabled"])])]),C.localTask!==y.RECURRING_JOB_TASK.SYSTEM_BACKUP?((0,t.openBlock)(),(0,t.createElementBlock)("div",c,[(0,t.createElementVNode)("div",u,[(0,t.createVNode)(S,{value:o.value.spec.concurrency,"onUpdate:value":a[4]||(a[4]=e=>o.value.spec.concurrency=e),valueModifiers:{number:!0},mode:o.mode,type:"number",label:e.t("longhorn.recurringJob.table.header.concurrency"),min:1,rules:e.fvGetAndReportPathRules("spec.concurrency"),required:""},null,8,["value","mode","label","rules"])])])):(0,t.createCommentVNode)("",!0),(0,t.createElementVNode)("div",p,[(0,t.createElementVNode)("div",v,[(0,t.createVNode)(S,{value:o.value.spec.cron,"onUpdate:value":a[5]||(a[5]=e=>o.value.spec.cron=e),mode:o.mode,type:"cron",label:e.t("longhorn.recurringJob.table.header.schedule"),rules:e.fvGetAndReportPathRules("spec.cron"),required:""},null,8,["value","mode","label","rules"])]),(0,t.createElementVNode)("div",m,[o.mode!==y._VIEW?((0,t.openBlock)(),(0,t.createElementBlock)("button",{key:0,type:"button",class:"btn role-tertiary",onClick:a[6]||(a[6]=e=>y.showCronModal=!0)},(0,t.toDisplayString)(e.t("generic.edit")),1)):(0,t.createCommentVNode)("",!0)])]),[y.RECURRING_JOB_TASK.BACKUP,y.RECURRING_JOB_TASK.SYSTEM_BACKUP].includes(C.localTask)?((0,t.openBlock)(),(0,t.createElementBlock)("div",h,[(0,t.createElementVNode)("div",b,[(0,t.createVNode)(V,{value:o.value.spec.parameters,"onUpdate:value":a[7]||(a[7]=e=>o.value.spec.parameters=e),mode:o.mode,"key-options":C.parameterKeyOptions,"key-editable":!1,"remove-allowed":!0},{title:(0,t.withCtx)(()=>[(0,t.createElementVNode)("h4",null,(0,t.toDisplayString)(e.t("longhorn.recurringJob.form.parameters")),1)]),key:(0,t.withCtx)(({row:e})=>[(0,t.createVNode)(A,{value:e.key,"onUpdate:value":a=>e.key=a,label:"Key",options:C.parameterKeyOptions,mode:o.mode,disabled:""},null,8,["value","onUpdate:value","options","mode"])]),value:(0,t.withCtx)(({row:a,queueUpdate:r})=>[C.localTask===y.RECURRING_JOB_TASK.SYSTEM_BACKUP?((0,t.openBlock)(),(0,t.createBlock)(A,{key:0,value:a.value,"onUpdate:value":[e=>a.value=e,r],label:"Value",options:C.volumeBackupPolicyOptions,mode:o.mode,rules:e.fvGetAndReportPathRules(`spec.parameters.${a.key}`)},null,8,["value","onUpdate:value","options","mode","rules"])):((0,t.openBlock)(),(0,t.createBlock)(S,{key:1,value:a.value,"onUpdate:value":[e=>a.value=e,r],label:"Value",mode:o.mode,type:a.key===y.PARAM_KEYS.FULL_BACKUP_INTERVAL?"number":"text",rules:a.key?e.fvGetAndReportPathRules(`spec.parameters.${a.key}`):[]},null,8,["value","onUpdate:value","mode","type","rules"]))]),add:(0,t.withCtx)(({add:a})=>[(0,t.createElementVNode)("button",{type:"button",class:"btn role-tertiary add",disabled:!C.canAddParameter,onClick:()=>{C.addParameter(),a()}},(0,t.toDisplayString)(e.t("generic.add")),9,k)]),removeButton:(0,t.withCtx)(({remove:a,row:r,i:s})=>[(0,t.createElementVNode)("button",{type:"button",class:"btn role-link",disabled:o.mode===y._VIEW||C.localTask===y.RECURRING_JOB_TASK.SYSTEM_BACKUP&&r.key===y.PARAM_KEYS.VOLUME_BACKUP_POLICY,onClick:e=>a(s)},(0,t.toDisplayString)(e.t("generic.remove")),9,g)]),_:1},8,["value","mode","key-options"])])])):(0,t.createCommentVNode)("",!0)]),_:1},8,["error"]),C.localTask!==y.RECURRING_JOB_TASK.SYSTEM_BACKUP?((0,t.openBlock)(),(0,t.createBlock)(_,{key:0,name:"labels","label-key":"longhorn.recurringJob.tab.labels"},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(T,{value:o.value.spec.groups,"onUpdate:value":a[8]||(a[8]=e=>o.value.spec.groups=e),mode:o.mode,title:e.t("longhorn.recurringJob.table.header.groups"),"add-label":e.t("generic.add")},null,8,["value","mode","title","add-label"]),(0,t.createVNode)(V,{value:o.value.spec.labels,"onUpdate:value":a[9]||(a[9]=e=>o.value.spec.labels=e),mode:o.mode,title:e.t("longhorn.recurringJob.table.header.labels")},null,8,["value","mode","title"])]),_:1})):(0,t.createCommentVNode)("",!0)]),_:1},8,["resource"])]),_:1},8,["done-route","mode","resource","validation-passed","errors","onFinish","onCancel","onError"]),(0,t.createVNode)(I,{show:y.showCronModal,"onUpdate:show":a[10]||(a[10]=e=>y.showCronModal=e),"cron-expression":o.value.spec.cron,"onUpdate:cronExpression":a[11]||(a[11]=e=>o.value.spec.cron=e)},null,8,["show","cron-expression"])]))}var y=o(87619),C=o(81984),N=o(79287),E=o(90175),A=o(64676),R=o(99957),S=o(52879),V=o(38891),_=o(80004),T=o(91825),U=o(77651),B=o(14220),I=o(99726),O=o(76978),P=o(92043),w=o(79380),L=o(42200),K=o(18418);const M={BACKUP:"backup",SNAPSHOT:"snapshot",SNAPSHOT_DELETE:"snapshot-delete",SNAPSHOT_CLEANUP:"snapshot-cleanup",SYSTEM_BACKUP:"system-backup",FILESYSTEM_TRIM:"filesystem-trim"},q={FULL_BACKUP_INTERVAL:"full-backup-interval",VOLUME_BACKUP_POLICY:"volume-backup-policy"},x={IF_NOT_PRESENT:"if-not-present",ALWAYS:"always",DISABLED:"disabled"},G={retain:1,concurrency:1,cron:"0 0 * * *",groups:[],labels:{},parameters:{}};var D={name:"EditRecurringJob",components:{Loading:y.A,CruResource:C.A,NameNsDescription:N.A,LabeledInput:w.o,LabeledSelect:E.A,Checkbox:L.S,ArrayList:A.A,KeyValue:R.A,Tabbed:S.A,Tab:V.A,CronExpressionEditorModal:_.A},mixins:[T.A,U.A],props:{mode:{type:String,default:B.YQ},value:{type:Object,required:!0}},data(){return{_CREATE:B.YQ,_VIEW:B.nW,LONGHORN_NAMESPACE:K.md,RECURRING_JOB_TASK:M,PARAM_KEYS:q,VOLUME_BACKUP_POLICY:x,fvFormRuleSets:[],showCronModal:!1,forceCreate:!1}},computed:{taskOptions(){return[{label:this.t("longhorn.recurringJob.form.taskOptions.backup"),value:M.BACKUP},{label:this.t("longhorn.recurringJob.form.taskOptions.snapshot"),value:M.SNAPSHOT},{label:this.t("longhorn.recurringJob.form.taskOptions.snapshotDelete"),value:M.SNAPSHOT_DELETE},{label:this.t("longhorn.recurringJob.form.taskOptions.snapshotCleanup"),value:M.SNAPSHOT_CLEANUP},{label:this.t("longhorn.recurringJob.form.taskOptions.systemBackup"),value:M.SYSTEM_BACKUP},{label:this.t("longhorn.recurringJob.form.taskOptions.filesystemTrim"),value:M.FILESYSTEM_TRIM}]},parameterKeyOptions(){return this.localTask===M.SYSTEM_BACKUP?[q.VOLUME_BACKUP_POLICY]:[q.FULL_BACKUP_INTERVAL]},volumeBackupPolicyOptions(){return Object.values(x).map(e=>({label:e,value:e}))},canAddParameter(){if(this.mode===B.nW)return!1;const e=this.value?.spec?.parameters||{},a=Object.keys(e).filter(e=>""!==e);return a.length<this.parameterKeyOptions.length},isForceCreateSupported(){return[M.BACKUP,M.SNAPSHOT].includes(this.localTask)},localTask:{get(){return(this.value?.spec?.task||"").replace("-force-create","")},set(e){this.value.spec||(0,O.hZ)(this.value,"spec",{});const a=this.forceCreate&&[M.SNAPSHOT,M.BACKUP].includes(e)?`${e}-force-create`:e;(0,O.hZ)(this.value.spec,"task",a)}},validationSchema(){const e=[{path:"metadata.name",rules:["required"],translationKey:"generic.name"},{path:"spec.task",rules:["required"],translationKey:"longhorn.recurringJob.table.header.task"},{path:"spec.retain",rules:["requiredInt","min:0","isPositive"],translationKey:"longhorn.recurringJob.table.header.retain"},{path:"spec.cron",rules:["required"],translationKey:"longhorn.recurringJob.table.header.schedule"}];this.localTask!==M.SYSTEM_BACKUP&&e.push({path:"spec.concurrency",rules:["requiredInt","min:1","isPositive"],translationKey:"longhorn.recurringJob.table.header.concurrency"});const a=this.value?.spec?.parameters||{};return Object.keys(a).forEach(a=>{if(a?.trim()){const o=["required"];a===q.FULL_BACKUP_INTERVAL&&o.push("requiredInt","min:0","isPositive"),e.push({path:`spec.parameters.${a}`,rules:o})}}),{basics:e}},tabErrors(){const e=this.validationSchema;if(!e?.basics)return{basics:!1};const a=e=>e.some(e=>{const a=(0,O.Jt)(this.value,e.path),o=this.fvGetPathRules(e.path)||[];return o.some(e=>"string"===typeof e(a))});return{basics:a(e.basics)}},isFormValid(){return!1===this.tabErrors?.basics}},created(){this.initResource()},methods:{initResource(){this.value.metadata||(0,O.hZ)(this.value,"metadata",{}),this.value.spec||(0,O.hZ)(this.value,"spec",{}),this.mode===B.YQ&&(this.value.metadata.name||(0,O.hZ)(this.value.metadata,"name",`c-${(0,P.vx)(6).toLowerCase()}`),this.value.spec.task||(0,O.hZ)(this.value.spec,"task",M.SNAPSHOT)),this.forceCreate=!!this.value.spec.task?.endsWith("-force-create"),Object.entries(G).forEach(([e,a])=>{void 0===this.value.spec[e]&&(0,O.hZ)(this.value.spec,e,JSON.parse(JSON.stringify(a)))}),this.initParametersByTask()},onError(e){this.errors=Array.isArray(e)?e:[e]},initParametersByTask(){if(!this.value?.spec)return;this.value.spec.parameters||(0,O.hZ)(this.value.spec,"parameters",{});const e=this.localTask,a=this.value.spec.parameters;e===M.SYSTEM_BACKUP?void 0===a[q.VOLUME_BACKUP_POLICY]&&(0,O.hZ)(this.value.spec.parameters,q.VOLUME_BACKUP_POLICY,x.IF_NOT_PRESENT):e===M.BACKUP&&void 0!==a[""]&&(0,O.hZ)(this.value.spec,"parameters",{})},addParameter(){const e=this.parameterKeyOptions,a=JSON.parse(JSON.stringify(this.value.spec.parameters||{})),o=e.find(e=>e&&!Object.keys(a).includes(e));if(o){void 0!==a[""]&&delete a[""];const e=this.localTask===M.SYSTEM_BACKUP?x.IF_NOT_PRESENT:"0";a[o]=e,(0,O.hZ)(this.value.spec,"parameters",{...a})}},async save(e){if(this.errors=[],!this.isFormValid)return e(!1);try{this.value.metadata?.name&&(this.value.spec.name=this.value.metadata.name);const a={...this.value.spec.parameters};Object.keys(a).forEach(e=>{e&&""!==e.trim()||delete a[e]}),(0,O.hZ)(this.value.spec,"parameters",a),await this.actuallySave(),e(!0),this.done()}catch(a){this.errors=(0,I.rz)(a),e(!1)}}},watch:{validationSchema:{handler(e){const a=e?.basics||[];this.fvFormRuleSets=a,this.fvReportedValidationPaths=a.map(e=>e.path)},immediate:!0,deep:!0},async localTask(e,a){e!==a&&this.value.spec&&((0,O.hZ)(this.value.spec,"parameters",{}),Object.entries(G).forEach(([e,a])=>{(0,O.hZ)(this.value.spec,e,JSON.parse(JSON.stringify(a)))}),this.initParametersByTask(),await this.$nextTick(),e===M.FILESYSTEM_TRIM&&(0,O.hZ)(this.value.spec,"retain",0),e===M.SYSTEM_BACKUP&&(0,O.hZ)(this.value.spec,"concurrency",1))}}},F=(o(93357),o(47433));const J=(0,F.A)(D,[["render",f],["__scopeId","data-v-11b5f0be"]]);var Y=J},54732:function(e,a,o){"use strict";o.r(a),o.d(a,{default:function(){return R}});var t=o(9274);const r={key:1},s={class:"row mb-20"},n={class:"row mb-20"},l={class:"row"};function i(e,a,o,i,d,c){const u=(0,t.resolveComponent)("Loading"),p=(0,t.resolveComponent)("NameNsDescription"),v=(0,t.resolveComponent)("LabeledInput"),m=(0,t.resolveComponent)("UnitInput"),h=(0,t.resolveComponent)("Tab"),b=(0,t.resolveComponent)("Tabbed"),k=(0,t.resolveComponent)("CruResource");return e.$fetchState.pending?((0,t.openBlock)(),(0,t.createBlock)(u,{key:0})):((0,t.openBlock)(),(0,t.createElementBlock)("div",r,[(0,t.createVNode)(k,{"done-route":e.doneRoute,mode:o.mode,resource:o.value,"validation-passed":e.fvFormIsValid,errors:e.fvUnreportedValidationErrors,onFinish:c.save,onCancel:e.done,onError:c.onError},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(p,{value:o.value,mode:o.mode,"force-namespace":d.LONGHORN_NAMESPACE},null,8,["value","mode","force-namespace"]),(0,t.createVNode)(b,{"side-tabs":"",resource:o.value},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(h,{name:"basics","label-key":"longhorn.backupTarget.tab.basics"},{default:(0,t.withCtx)(()=>[(0,t.createElementVNode)("div",s,[(0,t.createVNode)(v,{value:o.value.spec.backupTargetURL,"onUpdate:value":a[0]||(a[0]=e=>o.value.spec.backupTargetURL=e),"label-key":"longhorn.backupTarget.table.header.backupTargetURL",mode:o.mode,rules:e.fvGetAndReportPathRules("spec.backupTargetURL"),required:""},null,8,["value","mode","rules"])]),(0,t.createElementVNode)("div",n,[(0,t.createVNode)(v,{value:o.value.spec.credentialSecret,"onUpdate:value":a[1]||(a[1]=e=>o.value.spec.credentialSecret=e),"label-key":"longhorn.backupTarget.table.header.credentialSecret",mode:o.mode,placeholder:"e.g. s3-secret"},null,8,["value","mode"])]),(0,t.createElementVNode)("div",l,[(0,t.createVNode)(m,{value:o.value.spec.pollInterval,"onUpdate:value":a[2]||(a[2]=e=>o.value.spec.pollInterval=e),label:e.t("longhorn.backupTarget.table.header.pollInterval"),mode:o.mode,suffix:e.t("suffix.seconds",{count:o.value.spec.pollInterval||0}),min:0,rules:e.fvGetAndReportPathRules("spec.pollInterval"),"tooltip-key":"longhorn.backupTarget.form.pollInterval.tooltip"},null,8,["value","label","mode","suffix","rules"])])]),_:1})]),_:1},8,["resource"])]),_:1},8,["done-route","mode","resource","validation-passed","errors","onFinish","onCancel","onError"])]))}var d=o(87619),c=o(81984),u=o(79287),p=o(79380),v=o(52879),m=o(38891),h=o(91825),b=o(77651),k=o(14220),g=o(99726),f=o(18418),y=o(74020),C=o(76978),N={name:"EditBackupTarget",components:{Loading:d.A,CruResource:c.A,NameNsDescription:u.A,LabeledInput:p.o,Tabbed:v.A,Tab:m.A,UnitInput:y.A},mixins:[h.A,b.A],props:{mode:{type:String,default:k.YQ},value:{type:Object,required:!0}},data(){return{LONGHORN_NAMESPACE:f.md,_VIEW:k.nW,fvFormRuleSets:[{path:"spec.backupTargetURL",rules:["required"],translationKey:"longhorn.backupTarget.table.header.backupTargetURL"},{path:"spec.pollInterval",rules:["min:0","isPositive"],translationKey:"longhorn.backupTarget.table.header.pollInterval"}]}},created(){this.initResource()},methods:{parseDurationToSeconds(e){if(!e||"string"!==typeof e)return e;const a=/((?<h>\d+)h)?((?<m>\d+)m)?((?<s>\d+)s?)?/,o=e.match(a);if(o&&o.groups){const{h:e,m:a,s:t}=o.groups,r=3600*parseInt(e||0,10)+60*parseInt(a||0,10)+parseInt(t||0,10);return r}return parseInt(e,10)||0},initResource(){if(this.value.spec||(0,C.hZ)(this.value,"spec",{}),void 0!==this.value.spec.pollInterval){const e=this.parseDurationToSeconds(this.value.spec.pollInterval);(0,C.hZ)(this.value.spec,"pollInterval",e)}else this.mode===k.YQ&&(0,C.hZ)(this.value.spec,"pollInterval",300)},onError(e){this.errors=Array.isArray(e)?e:[e]},async save(e){this.errors=[];try{const a=this.value.spec;if(void 0!==a.pollInterval&&null!==a.pollInterval&&""!==a.pollInterval){const e=parseInt(a.pollInterval,10),o=isNaN(e)||e<0?0:e;(0,C.hZ)(a,"pollInterval",`${o}s`)}await this.actuallySave(),e(!0),this.done()}catch(a){this.errors=(0,g.rz)(a),e(!1),this.initResource()}}}},E=o(47433);const A=(0,E.A)(N,[["render",i]]);var R=A},64046:function(e,a,o){"use strict";o.r(a),o.d(a,{default:function(){return y}});var t=o(9274);const r={key:1};function s(e,a,o,s,n,l){const i=(0,t.resolveComponent)("Loading"),d=(0,t.resolveComponent)("NameNsDescription"),c=(0,t.resolveComponent)("LabeledInput"),u=(0,t.resolveComponent)("Tab"),p=(0,t.resolveComponent)("Tabbed"),v=(0,t.resolveComponent)("CruResource");return e.$fetchState.pending?((0,t.openBlock)(),(0,t.createBlock)(i,{key:0})):((0,t.openBlock)(),(0,t.createElementBlock)("div",r,[(0,t.createVNode)(v,{"done-route":e.doneRoute,mode:o.mode,resource:o.value,"validation-passed":e.fvFormIsValid,errors:e.fvUnreportedValidationErrors,onFinish:l.save,onCancel:e.done,onError:l.onError},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(d,{value:o.value,mode:o.mode,"name-hidden":o.mode!==n._VIEW,"description-hidden":!0,"force-namespace":n.LONGHORN_NAMESPACE},null,8,["value","mode","name-hidden","force-namespace"]),(0,t.createVNode)(p,{"side-tabs":"",resource:o.value},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(u,{name:"basics","label-key":"longhorn.engineImage.tab.basics"},{default:(0,t.withCtx)(()=>[(0,t.createVNode)(c,{value:o.value.spec.image,"onUpdate:value":a[0]||(a[0]=e=>o.value.spec.image=e),"label-key":"longhorn.engineImage.form.image",mode:o.mode,rules:e.fvGetAndReportPathRules("spec.image")},null,8,["value","mode","rules"])]),_:1})]),_:1},8,["resource"])]),_:1},8,["done-route","mode","resource","validation-passed","errors","onFinish","onCancel","onError"])]))}var n=o(87619),l=o(81984),i=o(79287),d=o(79380),c=o(52879),u=o(38891),p=o(91825),v=o(77651),m=o(14220),h=o(99726),b=o(18418),k={name:"EditEngineImage",components:{Loading:n.A,CruResource:l.A,NameNsDescription:i.A,LabeledInput:d.o,Tabbed:c.A,Tab:u.A},mixins:[p.A,v.A],props:{mode:{type:String,default:m.YQ},value:{type:Object,required:!0}},data(){return{fvFormRuleSets:[{path:"spec.image",rules:["required"],translationKey:"longhorn.engineImage.form.image"}],LONGHORN_NAMESPACE:b.md,_VIEW:m.nW}},created(){this.value.spec||(this.value.spec={}),void 0===this.value.spec.image&&(this.value.spec.image="")},methods:{onError(e){this.errors=Array.isArray(e)?e:[e]},async save(e){if(this.errors=[],!this.value.spec.image)return this.errors.push(this.t("longhorn.engineImage.form.validation.imageRequired")),void e(!1);try{await this.actuallySave(),e(!0),this.done()}catch(a){this.errors=(0,h.rz)(a)}}}},g=o(47433);const f=(0,g.A)(k,[["render",s]]);var y=f},66960:function(e,a,o){var t=o(76592);t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[e.id,t,""]]),t.locals&&(e.exports=t.locals);var r=o(74825).A;r("45fa92d3",t,!0,{sourceMap:!1,shadowMode:!1})},76592:function(e,a,o){"use strict";o.r(a);var t=o(36758),r=o.n(t),s=o(40935),n=o.n(s),l=n()(r());l.push([e.id,".conditions[data-v-b0addee8]{display:flex;flex-wrap:wrap}",""]),a["default"]=l},84918:function(e,a,o){"use strict";o.d(a,{_:function(){return t}});const t="Gi"},93357:function(e,a,o){var t=o(28173);t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[e.id,t,""]]),t.locals&&(e.exports=t.locals);var r=o(74825).A;r("46c1cc09",t,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=longhorn-0.1.0.umd.min.edit.js.map